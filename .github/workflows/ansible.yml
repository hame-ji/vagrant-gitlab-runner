name: CI

on:
  push:
    branches: [main]
  pull_request:

concurrency:
  group: ${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: true

jobs:
  lint:
    runs-on: ubuntu-latest
    
    steps:
      - uses: actions/checkout@v4
      
      - uses: actions/setup-python@v5
        with:
          python-version: '3.12'
      
      - name: Install tools
        run: |
          pip install ansible-lint
          wget -qO vagrant.deb https://releases.hashicorp.com/vagrant/2.4.9/vagrant_2.4.9-1_amd64.deb
          sudo dpkg -i vagrant.deb
      
      - name: Validate Vagrantfiles
        run: |
          shopt -s globstar
          for f in **/Vagrantfile; do
            [[ -f "$f" ]] || continue
            echo "ğŸ” Validating $f"
            (cd "$(dirname "$f")" && vagrant validate --ignore-provider)
          done
      
      # - name: Lint Ansible
      #   run: |
      #     cat > .ansible-lint <<EOF
      #     skip_list:
      #       - var-naming[no-role-prefix]
      #     warn_list:
      #       - experimental
      #     exclude_paths:
      #       - '*/secrets.yml'
      #       - '*/vault.yml'
      #     EOF
      #     ansible-lint --force-color --strict